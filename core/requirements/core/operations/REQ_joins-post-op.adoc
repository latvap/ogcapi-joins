[[req_core_joins-post-op]]
[width="90%",cols="2,6a"]
|===
^|*Requirement {counter:req-id}* |*/req/core/joins-post-op* 
^|A |The server SHALL support the HTTP POST operation at path `{root}/joins`.
^|B |The server SHALL support the `join-type` parameter value `hosted`.
^|C |The server MAY support the `join-type` parameter value `file`.
^|D |The request is made as a <<rfc7578,multipart/form-data>> request. 

The request SHALL contain the header:

* Content-Type: multipart/form-data;
^|E |If the attribute dataset file is uploaded with the query, it SHALL contain the header

* Content-Disposition: form-data; filename="[attribute dataset file's name]"; name="attribute-dataset-file";
^|F |If the spatial dataset file is uploaded with the query, it SHALL contain the header:

* Content-Disposition: form-data; filename="[spatial dataset file's name]"; name="spatial-dataset-file";
^|G |The input data files SHALL be encoded with the `UTF-8` encoding.
^|H |The server SHALL support the GeoJSON output format for the joined data in the `join-type` parameter value `hosted`.
^|I |The server MAY support any other output formats for the joined data in the `join-type` parameter value `hosted`
^|J |The server MAY support a optional direct GeoJSON response for the joined data for the `join-type` parameter value `hosted`. In this case, the server returns the joined data directly to the client in the GeoJSON format instead of the join response document. The direct GeoJSON output can be requested with the __output-formats__ parameter value: `http://www.opengis.net/spec/ogcapi-joins-1/1.0/conf/output/geojson-direct`. 
^|K |If the server supports the `join-type` parameter value `file`, it SHALL support the GeoJSON output format for the joined dataset.
|===

[discrete]
====== Common Form Data Parameters for the join-type Parameter Values 'hosted' and 'file'

[[req_core_joins-post-op-common-parameters]]
[width="90%",cols="2,6a"]
|===
^|*Requirement {counter:req-id}* |*/req/core/joins-post-common-parameters* 
^|A |[cols="4,1,1,2",options="header"]
!===
! Name				        ! Description 	     ! Type and values ! Required
! join-type                 ! The type of join.  ! String, values: {'hosted', 'file'} ! Mandatory
! execution-type	        ! The join execution type. ! String, value: {'synchronous'} ! Optional^a^
! attribute-dataset-format  ! The format of the attribute dataset. ! String ! Mandatory^b^
! attribute-dataset-file	! The attribute dataset file (uploaded file). ! File ! Optional^c^
! attribute-dataset-url	    ! The attribute dataset URL. ! URL ! Optional^c^
! attribute-dataset-key	    ! The key field in the attribute dataset that contains the key values. ! String ! Mandatory^d^
! attribute-dataset-data-value-list	! Fields in the attribute dataset that contain the attribute values that will be joined. ! String, separated by commas ! Mandatory^e^
! csv-file-delimiter	    ! The delimiter character used in the CSV file. ! String ! Optional^f^
! csv-file-contains-header-row 	! Information on the existence of header row in the CSV file. ! Boolean, values: {true, false} ! Optional^g^
4+! ^a^  The core module supports only the value 'synchronous', other values may be defined in the extension modules.
4+! ^b^  The core module contains support for the value: 'csv'.
4+! ^c^  One of the parameters: __attribute-dataset-file__ or __attribute-dataset-url__ is mandatory to be used with the operation. The __attribute-dataset-file__ parameter can be used for uploading an attribute dataset file to the server. The __attribute-dataset-url__ parameter can be used for providing the attribute dataset file through URL link. If both parameters are provided in the query, the server SHALL send HTTP exception `400`.
4+! ^d^ The key field in the attribute dataset that contains the key values. For CSV format, this value is the column number that contains the key values (counting starts from 0).
4+! ^e^  For CSV format, the values are the column numbers that contain the attribute values that will be joined (counting starts from 0).
4+! ^f^ The __csv-file-delimiter__ parameter is mandatory to be used with the __attribute-dataset-format__ parameter value: 'csv'. The parameter is not required for other formats that may be defined in the extension modules.
4+! ^g^ The __csv-file-contains-header-row__ parameter is optional to be used with the __attribute-dataset-format__ parameter value: 'csv'. The parameter is not required for other formats that may be defined in the extension modules. Values: (__true__, __false__). If parameter is not provided in the request, default value __false__ is used. If parameter has value __true__, CSV file's header is assumed to be on the first row of the CSV file and data values are assumed to start from the second row. If parameter has value __false__, the data values are assumed to start from CSV file's first row.
!===

{empty} +
|===

[discrete]
====== Form Data Parameters for join-type Parameter Value 'hosted'

[[req_core_joins-post-op-hosted-parameters]]
[width="90%",cols="2,6a"]
|===
^|*Requirement {counter:req-id}* |*/req/core/joins-post-op-hosted-parameters* 
^|A |[cols="4,1,1,2",options="header"]
!===
! Name				        ! Description 	     ! Type and values ! Required
! output-formats		        ! List of output formats for the joined data that will be included to the response document. ! String, separated by commas ! Optional^a^
! include-join-metadata       ! Includes the joinInformation element to the response document. ! Boolean, values: {true, false} ! Optional^b^ 
! collection-id	            ! The value of the `id` attribute of the collection available on the server, to which the attribute data will be joined. ! String ! Mandatory
! collection-key	            ! The value of the `id` attribute of the key field of the collection that will be used in the join operation. ! String ! Optional^c^
! collection-crs	            ! The coordinate referense system of the joined dataset output. ! String ! Optional^d^
4+! ^a^  Comma-separated list of the outputs that will be included to the response document. The output formats that the server supports SHALL be listed in the server's conformance declaration. If the parameter value is not provided in the request, a default value 

`http://www.opengis.net/spec/ogcapi-joins-1/1.0/conf/output/geojson` 

is used. If the server supports the direct geojson response for the join it SHALL support the value 

`http://www.opengis.net/spec/ogcapi-joins-1/1.0/conf/output/geojson-direct`.

4+! ^b^ If parameter is not provided in the request, a default value __false__ is used. The parameter is not used with the `output-formats` parameter value

`http://www.opengis.net/spec/ogcapi-joins-1/1.0/conf/output/geojson-direct`

4+! ^c^ If the `collection-key` parameter is not provided in the request, a default key field value of the collection will be used in the join operation.
4+! ^d^ The value of the parameter SHALL be listed in the collection's `crs` array if the collection contains geometries. If omitted, the first value of the `crs` array off the collection will be used.
!===

{empty} +
|===

[discrete]
====== Form Data Parameters for join-type Parameter Value 'file'

[[req_core_joins-post-op-file-parameters]]
[width="90%",cols="2,6a"]
|===
^|*Requirement {counter:req-id}* |*/req/core/joins-post-op-file-parameters* 
^|A |[cols="4,1,1,2",options="header"]
!===
! Name				      ! Description 	     ! Type and values ! Required
! spatial-dataset-format  ! The format of the spatial dataset. ! String ! Mandatory^a^
! spatial-dataset-file    ! The spatial dataset file (uploaded file) ! File !  Optional^b^
! spatial-dataset-url	  ! A URL link to the spatial dataset file ! URL !  Optional^b^
! spatial-dataset-key     ! The path to the key field in the spatial dataset file that contains key values. Example: 'features.properties.key' ! String ! Mandatory
4+! ^a^  The core module contains support for the format: 

`http://www.opengis.net/spec/ogcapi-joins-1/1.0/conf/output/geojson`.

4+! ^b^  One of the parameters: __spatial-dataset-file__ or __spatial-dataset-url__ is mandatory to be used with the operation. The __spatial-dataset-file__ parameter can be used for uploading the spatial dataset file to the server. The __spatial-dataset-url__ parameter can be used for providing the spatial dataset file through URL link. If both parameters are provided in the query, the server SHALL send HTTP exception `400`.
!===

{empty} +
|===